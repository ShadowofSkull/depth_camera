

#include <Servo.h> 
#include <ros.h>
#include <std_msgs/UInt16MultiArray.h>

ros::NodeHandle nh;

Servo servo1;
Servo servo2;

void servo_cb(const std_msgs::UInt16MultiArray& cmd_msg) {
  if (cmd_msg.layout.dim[0].size == 2) {
    servo1.write(cmd_msg.data[0]); // set servo1 angle, should be from 0-180
    servo2.write(cmd_msg.data[1]); // set servo2 angle, should be from 0-180
    digitalWrite(13, HIGH - digitalRead(13)); // toggle led
  }
}

ros::Subscriber<std_msgs::UInt16MultiArray> sub("servo", servo_cb);

void setup() {
  pinMode(13, OUTPUT);

  nh.initNode();
  nh.subscribe(sub);
  
  servo1.attach(9); // attach servo1 to pin 9
  servo2.attach(3); // attach servo2 to pin 10
}

void loop() {
  nh.spinOnce();
  delay(1);
}
